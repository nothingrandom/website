var glimpse=function(a){"use strict";function n(a,b,c,d){var h=B(g);h.onload=function(){var a=h.naturalWidth,g=h.naturalHeight,k=v(a,g,c),m=null,n=D(h,k.width,k.height).data,o=n.length,p=0,q=[],r=0,s=0,t=0,u=[0,0,0],x=0;if(!d){for(p=0;o>p;p+=4)r=n[p],u[0]+=r,s=n[p+1],u[1]+=s,t=n[p+2],u[2]+=t,d!==!1&&(d=r===s&&s===t),q[x++]=w(r,s,t);m=y(u,x)}if(d===!0){q=[],x=0;var z=null===m;for(p=0;o>p;p+=12){for(var B=[],C=0;12>C;C+=4)r=n[p+C],s=n[p+C+1],t=n[p+C+2],B.push(Math.round((r+s+t)/3)),z&&r&&(u[0]+=r,u[1]+=s,u[2]+=t);q[x++]=w(B[0],B[1],B[2])}m=z?y(u,4*x):m}q=[(d?j:i)+m,a,f,g,e,l[k.width],q.join("")].join(""),b(q,{width:a,height:g,color:i+m,black:i+A(m),monochrome:d})},t(a)||(h.crossOrigin="anonymous"),h.src=a}function o(a,b,c,d){r(a,b,c,d)}function p(a,b,c,d){r(a,b,c,d,h)}function q(a,b,c,d){r(a,b,c,d,g)}function r(a,d,f,i,j){if(t(a))return n(a,function(a){r(a,d,j,f,i)},!1);var k=a.split(e),m=k[1].match(/.{1,2}/g),o=s(k[0]);isNaN(f)||(isNaN(i)?o.height=Math.round(o.height*f/o.width):o.height=i,o.width=f);var p=l.indexOf(m.shift()),q=m.length/p;o.monochrome&&(q=0|3*q);var u=B(h,p,q),v=F(u,p,q),w=v.data.length,y=0,z=0,A=0;if(o.monochrome)for(y=0;w>y;y+=12){A=x(m[z++]);var C=A[0],D=A[1],H=A[2];v.data[y]=C,v.data[y+1]=C,v.data[y+2]=C,v.data[y+3]=255,v.data[y+4]=D,v.data[y+5]=D,v.data[y+6]=D,v.data[y+7]=255,v.data[y+8]=H,v.data[y+9]=H,v.data[y+10]=H,v.data[y+11]=255}else for(y=0;w>y;y+=4)A=x(m[z++]),v.data[y]=A[0],v.data[y+1]=A[1],v.data[y+2]=A[2],v.data[y+3]=255;E(u,v);var I=B(g);I.onload=function(){var a=G(I,o.width,o.height);if(j!==h&&(a=a.toDataURL(c)),j){j===g&&(j=B(j,o.width,o.height),j.src=a,a=j);var e=b.base;o.monochrome&&(e+=" "+b.monochrome),a.className=e}d(a,o)},I.src=u.toDataURL(c)}function s(a,b){a=a.split(e)[0];var c=a.substr(7).split(f),d=a.substr(1,6),g=a[0]===j,h={width:c[0],height:c[1],color:i+d,black:i+A(d),monochrome:g};return"string"==typeof b?h[b]:h}function t(a){return/^data:image/.test(a)}function u(a,b,c){return b>a?b:a>c?c:a}function v(a,b,c){if(c!==!1){c=!isNaN(c)&&u(c,1,100)||50;var d=c/1500,e=1.28*c,f=a/b;f>1?(a=Math.round(u(a*d,6,e)),b=Math.round(a/f)):(b=Math.round(u(b*d,6,e)),a=Math.round(b*f))}return{width:a,height:b}}function w(a,b,c){function e(a){return d[Math.round(a/17)]}return m.hex[e(a)+e(b)+e(c)]}function x(a){function c(a){return parseInt(a+a,16)}var b=m.key[a];return[c(b[0]),c(b[1]),c(b[2])]}function y(a,b){b=isNaN(b)?1:b;var c=a[0]/b,d=a[1]/b,e=a[2]/b;return z(c)+z(d)+z(e)}function z(a){var b=Math.round(a).toString(16);return 1===b.length?0+b:b}function A(a){return a=a.match(/.{1,2}/g),a=parseInt(a[0],16)+parseInt(a[1],16)+parseInt(a[2],16),a=z(Math.round(a/3)),a+a+a}function B(b,c,d){var e=a.createElement(b);return c&&(e.width=c),d&&(e.height=d),e}function C(a){return a.getContext("2d")}function D(a,b,c){return C(G(a,b,c)).getImageData(0,0,b,c)}function E(a,b){C(a).putImageData(b,0,0)}function F(a,b,c){return C(a).createImageData(b,c)}function G(a,b,c){var d=B(h,b,c);return C(d).drawImage(a,0,0,b,c),d}var b={base:"preview",monochrome:"monochrome"},c="image/jpeg",d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/",e=",",f=":",g="img",h="canvas",i="#",j="m",k=function(a){for(var b=a.length,c=[],d=0;b>d;++d)for(var e=0;b>e;++e)for(var f=0;b>f;++f)c.push([a[d],a[e],a[f]].join(""));return c}(d.substr(0,16)),l=function(a){for(var b=a.length,c=[],d=0;b>d;++d)for(var e=0;b>e;++e)c.push([a[d],a[e]].join(""));return c}(d),m=function(a,b){for(var c=0;4096>c;++c){var d=k[c],e=l[c];a[d]=e,b[e]=d}return{hex:a,key:b}}({},{});return{create:n,base64:o,canvas:p,image:q,meta:s,get support(){return!!C(B(h))}}}(document);